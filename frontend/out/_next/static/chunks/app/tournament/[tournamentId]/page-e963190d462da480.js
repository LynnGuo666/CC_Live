(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[992],{776:function(e,t,s){Promise.resolve().then(s.bind(s,5780))},6221:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},1047:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},6362:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]])},2718:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]])},4743:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},2369:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}})},4369:function(e,t,s){"use strict";var a=s(2265),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=a.useState,c=a.useEffect,l=a.useLayoutEffect,i=a.useDebugValue;function d(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!r(e,s)}catch(e){return!0}}var o="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),a=n({inst:{value:s,getSnapshot:t}}),r=a[0].inst,o=a[1];return l(function(){r.value=s,r.getSnapshot=t,d(r)&&o({inst:r})},[e,s,t]),c(function(){return d(r)&&o({inst:r}),e(function(){d(r)&&o({inst:r})})},[e]),i(s),s};t.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:o},2860:function(e,t,s){"use strict";var a=s(2265),r=s(2558),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},c=r.useSyncExternalStore,l=a.useRef,i=a.useEffect,d=a.useMemo,o=a.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,s,a,r){var x=l(null);if(null===x.current){var m={hasValue:!1,value:null};x.current=m}else m=x.current;var u=c(e,(x=d(function(){function e(e){if(!i){if(i=!0,c=e,e=a(e),void 0!==r&&m.hasValue){var t=m.value;if(r(t,e))return l=t}return l=e}if(t=l,n(c,e))return t;var s=a(e);return void 0!==r&&r(t,s)?(c=e,t):(c=e,l=s)}var c,l,i=!1,d=void 0===s?null:s;return[function(){return e(t())},null===d?void 0:function(){return e(d())}]},[t,s,a,r]))[0],x[1]);return i(function(){m.hasValue=!0,m.value=u},[u]),o(u),u}},2558:function(e,t,s){"use strict";e.exports=s(4369)},5195:function(e,t,s){"use strict";e.exports=s(2860)},5780:function(e,t,s){"use strict";s.d(t,{default:function(){return D}});var a=s(7437),r=s(2265),n=s(9376),c=s(6689),l=s(9763);let i=(0,l.Z)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),d=(0,l.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var o=s(284),x=e=>{let{stage:t}=e,{events:s,playerScores:n,leaderboard:l,teamStats:x,streamMode:m,currentTournamentId:u}=(0,c.I)(),[h,g]=(0,r.useState)("events");return(0,r.useEffect)(()=>{},[t.id]),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 p-6",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)(o.Z,{className:"w-6 h-6 text-blue-500"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:t.title}),(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat("in_progress"===t.status?"bg-green-100 text-green-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"in_progress"===t.status?"进行中":"pending"===t.status?"等待开始":"已结束"})]}),t.description&&(0,a.jsx)("p",{className:"text-gray-600 mb-2",children:t.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[t.game_type&&(0,a.jsxs)("span",{children:["游戏类型: ",t.game_type]}),t.duration_minutes&&(0,a.jsxs)("span",{children:["预计时长: ",t.duration_minutes,"分钟"]}),(0,a.jsxs)("span",{children:["阶段ID: ",t.id]})]})]})})}),"video"===m&&u&&(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("div",{className:"aspect-video bg-black rounded-lg flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-white text-center",children:[(0,a.jsx)(o.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg",children:"视频直播播放器"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"集成B站或其他直播平台"})]})})}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"flex space-x-8 px-6",children:[(0,a.jsx)("button",{onClick:()=>g("events"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("events"===h?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"实时事件"}),(0,a.jsx)("button",{onClick:()=>g("leaderboard"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("leaderboard"===h?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"排行榜"}),(0,a.jsx)("button",{onClick:()=>g("players"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("players"===h?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"玩家详情"}),(0,a.jsx)("button",{onClick:()=>g("teams"),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors ".concat("teams"===h?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"团队统计"})]})}),(0,a.jsx)("div",{className:"p-6",children:(()=>{switch(h){case"events":return(0,a.jsx)("div",{className:"space-y-3",children:0===s.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无事件数据"}):s.slice(0,10).map((e,t)=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 border-l-4 border-blue-500",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.event_type}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleTimeString("zh-CN")})]}),e.player&&(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["玩家: ",e.player]}),e.data&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:(0,a.jsx)("pre",{className:"bg-gray-100 p-1 rounded overflow-x-auto",children:JSON.stringify(e.data,null,2)})})]},t))});case"leaderboard":return(0,a.jsx)("div",{className:"space-y-3",children:0===l.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无排行榜数据"}):l.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ".concat(1===e.rank?"bg-yellow-500":2===e.rank?"bg-gray-400":3===e.rank?"bg-amber-600":"bg-blue-500"),children:e.rank}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.player_name}),e.team&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.team})]})]}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:[e.total_score," 分"]})]},t))});case"players":return(0,a.jsx)("div",{className:"space-y-3",children:0===n.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无玩家数据"}):n.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.player_name}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:[e.score," 分"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:["等级: ",e.level]}),(0,a.jsxs)("div",{children:["血量: ",e.health]}),(0,a.jsxs)("div",{children:["经验: ",e.experience]})]}),e.custom_stats&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:(0,a.jsx)("pre",{className:"bg-gray-50 p-2 rounded overflow-x-auto",children:JSON.stringify(e.custom_stats,null,2)})})]},t))});case"teams":return(0,a.jsx)("div",{className:"space-y-3",children:0===x.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无团队数据"}):x.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.team_name}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:[e.total_score," 分"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(i,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["目标: ",e.objectives]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(d,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["进度: ",e.progress,"%"]})]})]}),e.custom_stats&&(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:(0,a.jsx)("pre",{className:"bg-gray-50 p-2 rounded overflow-x-auto",children:JSON.stringify(e.custom_stats,null,2)})})]},t))});default:return(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无数据"})}})()})]})};let m=(0,l.Z)("Vote",[["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}],["path",{d:"M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z",key:"1ezoue"}],["path",{d:"M22 19H2",key:"nuriw5"}]]);var u=s(5805),h=s(1723);let g=(0,l.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var p=s(6221),y=e=>{let{session:t}=e,{votingOptions:s,setVotingOptions:n}=(0,c.I)(),[l,i]=(0,r.useState)(null),[d,o]=(0,r.useState)(!1),[x,y]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[j,v]=(0,r.useState)("");(0,r.useEffect)(()=>{N()},[t.id]);let N=async()=>{try{let e=await fetch("/api/tournament/voting-sessions/".concat(t.id,"/results"));if(e.ok){let t=await e.json();y(t.options),n(t.options)}}catch(e){console.error("获取投票数据失败:",e)}},w=async()=>{if(l&&j.trim()&&!d){f(!0);try{let e=await fetch("/api/tournament/votes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:t.id,option_id:l,voter_id:j.trim(),voter_type:"user"})});if(e.ok)o(!0),await N();else{let t=await e.json();alert(t.detail||"投票失败")}}catch(e){console.error("投票失败:",e),alert("投票失败，请重试")}finally{f(!1)}}},S=x.reduce((e,t)=>e+t.vote_count,0),k="active"===t.status&&!d&&t.allow_public_voting;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,a.jsxs)("div",{className:"border-b border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(m,{className:"w-6 h-6 text-purple-500"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:t.title}),(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium text-white ".concat((e=>{switch(e){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"finished":return"bg-gray-500";default:return"bg-blue-500"}})(t.status)),children:(e=>{switch(e){case"active":return"投票中";case"pending":return"等待开始";case"finished":return"已结束";default:return e}})(t.status)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[S," 票"]})]}),t.end_time&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["截止: ",new Date(t.end_time).toLocaleString("zh-CN")]})]})]})]}),t.description&&(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:t.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,a.jsx)("span",{children:(e=>{switch(e){case"single_choice":return"单选投票";case"multiple_choice":return"多选投票";case"ranking":return"排序投票";default:return"投票"}})(t.voting_type)}),(0,a.jsxs)("span",{children:["每人最多 ",t.max_votes_per_user," 票"]}),!t.allow_public_voting&&(0,a.jsx)("span",{className:"text-red-500",children:"仅限参赛者投票"})]})]}),(0,a.jsxs)("div",{className:"p-6",children:[k?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"您的名称"}),(0,a.jsx)("input",{type:"text",value:j,onChange:e=>v(e.target.value),placeholder:"请输入您的名称",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"请选择您的选项"}),(0,a.jsx)("div",{className:"space-y-3",children:x.map(e=>(0,a.jsx)("div",{className:"relative border rounded-lg p-4 cursor-pointer transition-colors ".concat(l===e.id?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),onClick:()=>i(e.id),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full border-2 flex items-center justify-center ".concat(l===e.id?"border-purple-500 bg-purple-500":"border-gray-300"),children:l===e.id&&(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.option_text}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.vote_count," 票"]})]})},e.id))})]}),(0,a.jsx)("button",{onClick:w,disabled:!l||!j.trim()||b,className:"w-full bg-purple-500 text-white py-3 px-4 rounded-md hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-2",children:b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"提交中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"提交投票"})]})})]}):d?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(g,{className:"w-16 h-16 mx-auto mb-4 text-green-500"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"投票成功"}),(0,a.jsx)("p",{className:"text-gray-600",children:"感谢您的参与，投票结果将实时更新"})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(m,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"finished"===t.status?"投票已结束":"pending"===t.status?"投票尚未开始":t.allow_public_voting?"无法投票":"仅限参赛者投票"})]}),x.length>0&&(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"实时结果"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["(",S," 总票数)"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:x.map((e,t)=>{let s=S>0?e.vote_count/S*100:0;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.option_text}),(0,a.jsxs)("span",{className:"text-gray-600",children:[e.vote_count," 票 (",s.toFixed(1),"%)"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-500",style:{width:"".concat(s,"%")}})})]},e.id)})})]})]})]})},b=s(9474),f=s(1047),j=s(6362),v=s(2906),N=s(572),w=e=>{let{tournament:t}=e;return(0,a.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)(b.Z,{className:"w-8 h-8"}),(0,a.jsx)("h1",{className:"text-3xl font-bold",children:t.title}),(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium text-white ".concat((e=>{switch(e){case"in_progress":return"bg-green-500";case"pending":return"bg-yellow-500";case"finished":return"bg-gray-500";default:return"bg-blue-500"}})(t.status)),children:(e=>{switch(e){case"in_progress":return"进行中";case"pending":return"等待开始";case"finished":return"已结束";default:return e}})(t.status)})]}),t.description&&(0,a.jsx)("p",{className:"text-orange-100 text-lg mb-4 max-w-3xl",children:t.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:t.created_at&&(0,v.Z)(new Date(t.created_at),{addSuffix:!0,locale:N.Z})})]}),t.start_time&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:new Date(t.start_time).toLocaleString("zh-CN")})]}),t.max_participants&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["最多",t.max_participants,"人"]})]}),t.bilibili_url&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"}),(0,a.jsx)("a",{href:t.bilibili_url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-orange-200 transition-colors",children:"B站直播间"})]})]})]})}),(0,a.jsxs)("div",{className:"mt-6 text-sm text-orange-200",children:["锦标赛ID: ",t.id]})]})})};let S=(0,l.Z)("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);var k=s(3276),_=e=>{let{stages:t,currentStage:s,onStageSelect:r}=e,n=e=>{switch(e){case"game":return(0,a.jsx)(o.Z,{className:"w-4 h-4"});case"voting":return(0,a.jsx)(m,{className:"w-4 h-4"});case"break":return(0,a.jsx)(S,{className:"w-4 h-4"});default:return(0,a.jsx)(k.Z,{className:"w-4 h-4"})}},c=e=>{switch(e){case"game":return"游戏";case"voting":return"投票";case"break":return"休息";default:return"阶段"}},l=(e,t)=>{if(t)return"bg-blue-500 text-white border-blue-500";switch(e){case"in_progress":return"bg-green-50 text-green-700 border-green-200 hover:bg-green-100";case"pending":return"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100";case"finished":return"bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100";default:return"bg-white text-gray-700 border-gray-200 hover:bg-gray-50"}},i=e=>{switch(e){case"in_progress":return"进行中";case"pending":return"等待开始";case"finished":return"已结束";default:return e}};return 0===t.length?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsx)("div",{className:"text-center text-gray-500",children:"暂无阶段信息"})}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"比赛阶段"}),(0,a.jsx)("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:t.map((e,t)=>{let d=(null==s?void 0:s.id)===e.id,o=l(e.status,d);return(0,a.jsxs)("button",{onClick:()=>r(e),className:"flex-shrink-0 border rounded-lg p-3 transition-colors min-w-32 ".concat(o),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[n(e.stage_type),(0,a.jsxs)("span",{className:"text-xs font-medium",children:["第",e.stage_order,"阶段"]})]}),(0,a.jsx)("div",{className:"text-sm font-medium mb-1 text-left",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-500",children:c(e.stage_type)}),(0,a.jsx)("span",{children:i(e.status)})]}),e.duration_minutes&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 mt-1 text-xs text-gray-500",children:[(0,a.jsx)(h.Z,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:[e.duration_minutes,"分钟"]})]}),e.game_type&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.game_type})]},e.id)})}),s&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"当前阶段"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("in_progress"===s.status?"bg-green-100 text-green-800":"pending"===s.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:i(s.status)})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)("p",{className:"font-medium",children:s.title}),s.description&&(0,a.jsx)("p",{className:"mt-1",children:s.description})]}),s.start_time&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["开始时间: ",new Date(s.start_time).toLocaleString("zh-CN")]})]})]})},C=s(1860);function D(){let e=(0,n.useParams)().tournamentId,{tournament:t,tournamentStages:s,currentStage:l,currentVotingSession:i,comments:d,isConnected:o,setTournament:m,setTournamentStages:u,setCurrentStage:h,setCurrentTournament:g,setConnected:p,clearData:b}=(0,c.I)(),[f,j]=(0,r.useState)(!0),[v,N]=(0,r.useState)(null),S=async()=>{try{j(!0),N(null);let t=await fetch("/api/tournament/tournaments/".concat(e));if(!t.ok)throw Error("锦标赛不存在");let s=await t.json();m(s);let a=await fetch("/api/tournament/tournaments/".concat(e,"/stages"));if(a.ok){let e=await a.json();u(e);let t=e.find(e=>"in_progress"===e.status);if(t)h(t);else{let t=e.find(e=>"pending"===e.status);h(t||e[0]||null)}}}catch(e){console.error("获取锦标赛数据失败:",e),N(e instanceof Error?e.message:"获取数据失败")}finally{j(!1)}};return((0,r.useEffect)(()=>{if(e)return g(e),S(),p(!0),()=>{b()}},[e]),f)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载锦标赛数据中..."})]})}):v?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"加载失败"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:v}),(0,a.jsx)("button",{onClick:S,className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition-colors",children:"重新加载"})]})})}):t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(w,{tournament:t}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,a.jsx)(_,{stages:s,currentStage:l,onStageSelect:e=>{h(e)}}),(()=>{if(!l)return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无活动阶段"}),(0,a.jsx)("p",{className:"text-gray-600",children:"锦标赛尚未开始或已结束"})]})});switch(l.stage_type){case"voting":return i?(0,a.jsx)(y,{session:i}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"投票环节"}),(0,a.jsx)("p",{className:"text-gray-600",children:"投票尚未开始"})]})});case"game":return(0,a.jsx)(x,{stage:l});case"break":return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"休息时间"}),(0,a.jsx)("p",{className:"text-gray-600",children:l.description||"中场休息，请稍等"})]})});default:return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:l.title}),(0,a.jsx)("p",{className:"text-gray-600",children:l.description||"准备中..."})]})})}})()]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(C.z,{comments:d,isConnected:o,className:"h-96"})})]})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"锦标赛不存在"}),(0,a.jsx)("p",{className:"text-gray-600",children:"请检查锦标赛ID是否正确"})]})})}},1860:function(e,t,s){"use strict";s.d(t,{z:function(){return m}});var a=s(7437),r=s(2265),n=s(2369),c=s(2718),l=s(4743),i=s(988),d=s(2906),o=s(572);let x=e=>{let{comment:t}=e;return(0,a.jsxs)("div",{className:"chat-message other",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)(n.Z,{className:"w-3 h-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700",children:t.username}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:(0,d.Z)(new Date(t.timestamp),{addSuffix:!0,locale:o.Z})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-800",children:t.content})]})},m=e=>{let{comments:t,isConnected:s,className:d=""}=e,[o,m]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),g=(0,r.useRef)(null),[p,y]=(0,r.useState)(!1),b=()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};return(0,r.useEffect)(()=>{b()},[t]),(0,r.useEffect)(()=>{let e=localStorage.getItem("mc_live_username");e&&(h(e),y(!0))},[]),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg flex flex-col ".concat(d),children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 mr-2 text-green-500"}),"实时聊天",(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",t.length," 条消息)"]})]})}),(0,a.jsx)("div",{className:"flex-1 p-4 max-h-64 overflow-y-auto custom-scrollbar",children:0===t.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)(c.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),(0,a.jsx)("p",{className:"text-sm",children:"暂无聊天消息"}),(0,a.jsx)("p",{className:"text-xs",children:"成为第一个发言的人！"})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[t.map(e=>(0,a.jsx)(x,{comment:e},e.id)),(0,a.jsx)("div",{ref:g})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:p?(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o.trim()&&s&&u&&(i.X.sendComment(u,o.trim()),m(""))},className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:u}),(0,a.jsx)("button",{type:"button",onClick:()=>y(!1),className:"text-blue-500 hover:text-blue-600 ml-auto",children:"更换昵称"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>m(e.target.value),placeholder:s?"输入消息...":"连接中...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:200,disabled:!s}),(0,a.jsx)("button",{type:"submit",disabled:!o.trim()||!s,className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center",children:(0,a.jsx)(l.Z,{className:"w-4 h-4"})})]}),!s&&(0,a.jsx)("p",{className:"text-xs text-red-500",children:"连接已断开，请等待重连..."})]}):(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u.trim()&&(localStorage.setItem("mc_live_username",u.trim()),y(!0))},className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"设置昵称后开始聊天"}),(0,a.jsx)("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"输入你的昵称...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:20,required:!0})]}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors",children:"确认昵称"})]})})]})}},6689:function(e,t,s){"use strict";s.d(t,{I:function(){return a}});let a=(0,s(9625).Ue)((e,t)=>({isConnected:!1,currentMatchId:null,currentTournamentId:null,match:null,matchStatus:null,tournament:null,tournamentStages:[],currentStage:null,votingSessions:[],currentVotingSession:null,votingOptions:[],events:[],playerScores:[],leaderboard:[],teamStats:[],comments:[],streamMode:"text",setConnected:t=>e({isConnected:t}),setCurrentMatch:t=>e({currentMatchId:t}),setCurrentTournament:t=>e({currentTournamentId:t}),setMatch:t=>e({match:t}),setMatchStatus:t=>e({matchStatus:t}),setTournament:t=>e({tournament:t}),setTournamentStages:t=>e({tournamentStages:t}),setCurrentStage:t=>e({currentStage:t}),setVotingSessions:t=>e({votingSessions:t}),setCurrentVotingSession:t=>e({currentVotingSession:t}),setVotingOptions:t=>e({votingOptions:t}),addEvent:t=>e(e=>({events:[t,...e.events].slice(0,100)})),updatePlayerScores:t=>e({playerScores:t}),updateLeaderboard:t=>e({leaderboard:t}),updateTeamStats:t=>e({teamStats:t}),addComment:t=>e(e=>({comments:[t,...e.comments].slice(0,50)})),setStreamMode:t=>e({streamMode:t}),clearData:()=>e({events:[],playerScores:[],leaderboard:[],teamStats:[],comments:[],matchStatus:null,currentStage:null,votingSessions:[],currentVotingSession:null,votingOptions:[]})}))},988:function(e,t,s){"use strict";s.d(t,{X:function(){return n}});var a=s(6689);class r{connect(e){if(this.socket&&this.socket.connected){if(a.I.getState().currentMatchId===e)return;this.disconnect()}let t="https:"===window.location.protocol?"wss:":"ws:",s="".concat(t,"//").concat(window.location.host,"/ws/live/").concat(e);this.connectWebSocket(s,e)}connectWebSocket(e,t){try{let s=new WebSocket(e);s.onopen=()=>{console.log("✅ WebSocket连接成功: ".concat(t)),this.reconnectAttempts=0,a.I.getState().setConnected(!0),a.I.getState().setCurrentMatch(t)},s.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleMessage(t)}catch(e){console.error("解析WebSocket消息失败:",e)}},s.onclose=()=>{console.log("\uD83D\uDD0C WebSocket连接已断开"),a.I.getState().setConnected(!1),this.attemptReconnect(e,t)},s.onerror=e=>{console.error("❌ WebSocket连接错误:",e),a.I.getState().setConnected(!1)},this.socket=s}catch(e){console.error("创建WebSocket连接失败:",e)}}handleMessage(e){let t=a.I.getState();switch(e.type){case"connection_established":console.log("\uD83C\uDFAE 已连接到直播间:",e.match_id);break;case"game_event":console.log("\uD83C\uDFAF 收到游戏事件:",e.event),t.addEvent(e.event);break;case"player_scores_update":console.log("\uD83D\uDCCA 玩家分数更新:",e.players),t.updatePlayerScores(e.players);break;case"leaderboard_update":console.log("\uD83C\uDFC6 排行榜更新:",e.leaderboard),t.updateLeaderboard(e.leaderboard);break;case"match_status_update":console.log("⚡ 比赛状态更新:",e.status),t.setMatchStatus(e.status);break;case"team_stats_update":console.log("\uD83D\uDC65 团队数据更新:",e.teams),t.updateTeamStats(e.teams);break;case"new_comment":console.log("\uD83D\uDCAC 新评论:",e.comment),t.addComment(e.comment);break;case"pong":break;default:console.log("\uD83D\uDCE9 未知消息类型:",e.type,e)}}sendMessage(e){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(e)):console.warn("WebSocket未连接，无法发送消息")}sendComment(e,t){this.sendMessage({type:"comment",username:e,content:t})}sendPing(){this.sendMessage({type:"ping",timestamp:new Date().toISOString()})}attemptReconnect(e,t){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("❌ 达到最大重连次数，停止重连");return}this.reconnectAttempts++;let s=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log("\uD83D\uDD04 ".concat(s,"ms后尝试第").concat(this.reconnectAttempts,"次重连...")),setTimeout(()=>{this.connectWebSocket(e,t)},s)}disconnect(){this.socket&&(this.socket.close(),this.socket=null),a.I.getState().setConnected(!1)}isConnected(){return!!this.socket&&this.socket.readyState===WebSocket.OPEN}constructor(){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3}}let n=new r},9625:function(e,t,s){"use strict";s.d(t,{Ue:function(){return m}});let a=e=>{let t;let s=new Set,a=(e,a)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=a?a:"object"!=typeof r||null===r)?r:Object.assign({},t,r),s.forEach(s=>s(t,e))}},r=()=>t,n={setState:a,getState:r,getInitialState:()=>c,subscribe:e=>(s.add(e),()=>s.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},c=t=e(a,r,n);return n},r=e=>e?a(e):a;var n=s(2265),c=s(5195);let{useDebugValue:l}=n,{useSyncExternalStoreWithSelector:i}=c,d=!1,o=e=>e,x=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?r(e):e,s=(e,s)=>(function(e,t=o,s){s&&!d&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),d=!0);let a=i(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,s);return l(a),a})(t,e,s);return Object.assign(s,t),s},m=e=>e?x(e):x}},function(e){e.O(0,[203,971,117,744],function(){return e(e.s=776)}),_N_E=e.O()}]);