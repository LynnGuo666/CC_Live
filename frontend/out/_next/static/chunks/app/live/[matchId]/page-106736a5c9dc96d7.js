(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{5790:function(e,s,t){Promise.resolve().then(t.bind(t,3481))},3481:function(e,s,t){"use strict";t.d(s,{default:function(){return V}});var a=t(7437),c=t(2265),l=t(9376),n=t(6689),r=t(988),i=t(2906),o=t(572),d=t(395),m=t(9474),x=t(4794),h=t(6595),u=t(1239);let j=e=>{let{event:s}=e;return(0,a.jsx)("div",{className:(e=>{let s="event-card";switch(e){case"kill":case"player_kill":return"".concat(s," kill");case"achievement":return"".concat(s," achievement");case"item_pickup":return"".concat(s," item_pickup");default:return"".concat(s," default")}})(s.event_type),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(e=>{switch(e){case"kill":case"player_kill":return(0,a.jsx)(d.Z,{className:"w-4 h-4 text-red-500"});case"achievement":return(0,a.jsx)(m.Z,{className:"w-4 h-4 text-yellow-500"});case"item_pickup":return(0,a.jsx)(x.Z,{className:"w-4 h-4 text-green-500"});case"level_up":return(0,a.jsx)(h.Z,{className:"w-4 h-4 text-purple-500"});default:return(0,a.jsx)(u.Z,{className:"w-4 h-4 text-blue-500"})}})(s.event_type),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(e=>{let{event_type:s,player:t,target:a,data:c}=e;switch(s){case"kill":case"player_kill":return"".concat(t," 击败了 ").concat(a);case"achievement":return"".concat(t," 获得成就: ").concat((null==c?void 0:c.achievement_name)||"未知成就");case"item_pickup":return"".concat(t," 获得了 ").concat((null==c?void 0:c.item_name)||"物品");case"level_up":return"".concat(t," 升级到 ").concat((null==c?void 0:c.level)||"?"," 级");case"game_start":return"\uD83C\uDFAE 游戏开始！";case"game_end":return"\uD83C\uDFC1 游戏结束！";default:return"".concat(t||"系统",": ").concat(s)}})(s)}),s.data&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[s.data.location&&(0,a.jsxs)("span",{children:["位置: (",s.data.location.x,", ",s.data.location.y,", ",s.data.location.z,")"]}),s.data.weapon&&(0,a.jsxs)("span",{className:"ml-2",children:["武器: ",s.data.weapon]})]})]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-400 ml-2",children:(0,i.Z)(new Date(s.timestamp),{addSuffix:!0,locale:o.Z})})]})})},g=e=>{let{events:s,className:t=""}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg ".concat(t),children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 mr-2 text-blue-500"}),"实时事件"]})}),(0,a.jsx)("div",{className:"p-4 max-h-96 overflow-y-auto custom-scrollbar",children:0===s.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)(u.Z,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无游戏事件"}),(0,a.jsx)("p",{className:"text-sm",children:"等待游戏服务器推送数据..."})]}):(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,a.jsx)(j,{event:e},e.id))})})]})};var p=t(8617),b=t(6142),N=t(3327);let v=e=>{let{entry:s,index:t}=e;return(0,a.jsxs)("div",{className:(e=>{let s="flex items-center justify-between p-3 rounded-lg transition-all duration-200";switch(e){case 1:return"".concat(s," rank-1");case 2:return"".concat(s," rank-2");case 3:return"".concat(s," rank-3");default:return"".concat(s," bg-gray-50 hover:bg-gray-100")}})(s.rank),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(e=>{switch(e){case 1:return(0,a.jsx)(p.Z,{className:"w-5 h-5 text-yellow-500"});case 2:return(0,a.jsx)(b.Z,{className:"w-5 h-5 text-gray-400"});case 3:return(0,a.jsx)(N.Z,{className:"w-5 h-5 text-amber-600"});default:return(0,a.jsx)("span",{className:"w-5 h-5 flex items-center justify-center text-sm font-bold text-gray-600",children:e})}})(s.rank),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-semibold text-sm",children:s.player_name}),s.team&&(0,a.jsxs)("div",{className:"text-xs opacity-75",children:["团队: ",s.team]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-bold text-lg",children:s.total_score.toLocaleString()}),(0,a.jsx)("div",{className:"text-xs opacity-75",children:"分数"})]})]})},f=e=>{let{leaderboard:s,className:t=""}=e,c=[...s].sort((e,s)=>e.rank-s.rank);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg ".concat(t),children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 mr-2 text-yellow-500"}),"排行榜",(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",c.length," 位玩家)"]})]})}),(0,a.jsx)("div",{className:"p-4 max-h-96 overflow-y-auto custom-scrollbar",children:0===c.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)(m.Z,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无排行数据"}),(0,a.jsx)("p",{className:"text-sm",children:"等待比赛开始..."})]}):(0,a.jsx)("div",{className:"space-y-2",children:c.map((e,s)=>(0,a.jsx)(v,{entry:e,index:s},"".concat(e.player_name,"-").concat(e.rank)))})})]})};var y=t(2369),w=t(8997),S=t(6221);let k=e=>{var s;let{player:t}=e,c=e=>e>70?"text-green-500":e>30?"text-yellow-500":"text-red-500";return(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(y.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:t.player_name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"玩家"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:t.score.toLocaleString()}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"分数"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-purple-500"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium",children:["等级 ",t.level]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Level"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 text-yellow-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:t.experience}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"经验"})]})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 ".concat(c(t.health))}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"健康值"})]}),(0,a.jsxs)("span",{className:"text-sm font-bold ".concat(c(t.health)),children:[t.health,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat((s=t.health)>70?"bg-green-500":s>30?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(Math.max(0,Math.min(100,t.health)),"%")}})})]}),t.custom_stats&&Object.keys(t.custom_stats).length>0&&(0,a.jsxs)("div",{className:"border-t border-blue-200 pt-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 mb-2",children:"详细数据"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(t.custom_stats).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-gray-500",children:[s,":"]}),(0,a.jsx)("span",{className:"ml-1 font-medium",children:String(t)})]},s)})})]})]})},_=e=>{let{playerScores:s,className:t=""}=e,[l,n]=(0,c.useState)("score"),r=[...s].sort((e,s)=>{switch(l){case"score":default:return s.score-e.score;case"level":return s.level-e.level;case"health":return s.health-e.health}});return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg ".concat(t),children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,a.jsx)(S.Z,{className:"w-5 h-5 mr-2 text-blue-500"}),"玩家数据"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"排序:"}),(0,a.jsxs)("select",{value:l,onChange:e=>n(e.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"score",children:"分数"}),(0,a.jsx)("option",{value:"level",children:"等级"}),(0,a.jsx)("option",{value:"health",children:"健康值"})]})]})]})}),(0,a.jsx)("div",{className:"p-4 max-h-96 overflow-y-auto custom-scrollbar",children:0===r.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)(y.Z,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无玩家数据"}),(0,a.jsx)("p",{className:"text-sm",children:"等待游戏服务器推送数据..."})]}):(0,a.jsx)("div",{className:"space-y-4",children:r.map((e,s)=>(0,a.jsx)(k,{player:e},e.player_name))})})]})};var C=t(1860),Z=t(6362),D=t(8736),M=t(9897),I=t(3276);let E=e=>{let{streamMode:s,onModeChange:t,bilibiliUrl:c,className:l=""}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-4 ".concat(l),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"直播模式"}),c&&(0,a.jsxs)("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 hover:text-blue-600 flex items-center space-x-1",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"在B站观看"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("button",{onClick:()=>t("text"),className:"\n            flex flex-col items-center justify-center p-4 rounded-lg border-2 transition-all\n            ".concat("text"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 text-gray-600","\n          "),children:[(0,a.jsx)(D.Z,{className:"w-8 h-8 mb-2"}),(0,a.jsx)("span",{className:"font-medium",children:"文字直播"}),(0,a.jsx)("span",{className:"text-xs opacity-75 mt-1",children:"实时事件流"})]}),(0,a.jsxs)("button",{onClick:()=>t("video"),disabled:!c,className:"\n            flex flex-col items-center justify-center p-4 rounded-lg border-2 transition-all\n            ".concat("video"===s?"border-red-500 bg-red-50 text-red-700":c?"border-gray-200 hover:border-gray-300 text-gray-600":"border-gray-100 text-gray-400 cursor-not-allowed","\n          "),children:[(0,a.jsx)(M.Z,{className:"w-8 h-8 mb-2"}),(0,a.jsx)("span",{className:"font-medium",children:"视频直播"}),(0,a.jsx)("span",{className:"text-xs opacity-75 mt-1",children:c?"B站直播间":"暂无视频源"})]})]}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:"text"===s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(D.Z,{className:"w-4 h-4 text-blue-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"当前: 文字直播模式"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{className:"w-4 h-4 text-red-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"当前: 视频直播模式"})]})}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"text"===s?"查看实时游戏事件、玩家数据和排行榜":"观看B站高清视频直播"})]})]})};var A=t(2660),O=t(284),W=t(1723),F=t(5805),T=t(2926),L=t(5395),P=t(7168);function V(){let e=(0,l.useParams)().matchId,{isConnected:s,match:t,matchStatus:i,events:o,playerScores:d,leaderboard:m,teamStats:x,comments:h,streamMode:u,setStreamMode:j,setCurrentMatch:p,clearData:b}=(0,n.I)(),[N,v]=(0,c.useState)(!0);(0,c.useEffect)(()=>(e&&(p(e),r.X.connect(e),y()),()=>{r.X.disconnect(),b()}),[e]),(0,c.useEffect)(()=>{s&&v(!1)},[s]);let y=async()=>{try{let s=await fetch("/api/matches/".concat(e));if(s.ok){let e=await s.json();n.I.getState().setMatch(e)}}catch(e){console.error("获取比赛数据失败:",e)}finally{v(!1)}},w=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"));return N?(0,a.jsx)("div",{className:"min-h-screen live-container flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)("div",{className:"loading-spinner mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"连接直播间中..."}),(0,a.jsx)("p",{className:"text-white/80",children:"正在建立WebSocket连接"})]})}):(0,a.jsxs)("div",{className:"min-h-screen live-container",children:[(0,a.jsx)("div",{className:"bg-white/10 backdrop-blur-sm border-b border-white/20",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>window.history.back(),className:"text-white hover:text-white/80 transition-colors",children:(0,a.jsx)(A.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-white",children:(null==t?void 0:t.title)||"比赛 ".concat(e)}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-white/80 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(O.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:(null==t?void 0:t.game_type)||"小游戏"})]}),(null==i?void 0:i.time_remaining)&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(W.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["剩余: ",w(i.time_remaining)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[d.length," 位玩家"]})]})]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-3",children:(0,a.jsx)("div",{className:"flex items-center space-x-2",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Z,{className:"w-5 h-5 text-green-400"}),(0,a.jsx)("span",{className:"text-white text-sm",children:"已连接"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.Z,{className:"w-5 h-5 text-red-400"}),(0,a.jsx)("span",{className:"text-white text-sm",children:"连接断开"}),(0,a.jsx)("button",{onClick:()=>{v(!0),r.X.disconnect(),setTimeout(()=>{r.X.connect(e)},1e3)},className:"text-white hover:text-white/80 transition-colors",children:(0,a.jsx)(P.Z,{className:"w-4 h-4"})})]})})})]})})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:"text"===u?(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsx)(g,{events:o}),(0,a.jsx)(_,{playerScores:d})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(f,{leaderboard:m}),(0,a.jsx)(C.z,{comments:h,isConnected:s,className:"min-h-[300px]"}),(0,a.jsx)(E,{streamMode:u,onModeChange:j,bilibiliUrl:null==t?void 0:t.bilibili_url})]})]}):(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-3",children:[(0,a.jsx)("div",{className:"bg-black rounded-lg aspect-video flex items-center justify-center",children:(null==t?void 0:t.bilibili_url)?(0,a.jsx)("iframe",{src:t.bilibili_url,className:"w-full h-full rounded-lg",allowFullScreen:!0,title:"B站直播"}):(0,a.jsxs)("div",{className:"text-white text-center",children:[(0,a.jsx)(M.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg",children:"暂无视频直播"}),(0,a.jsx)("p",{className:"text-sm opacity-75",children:"请切换到文字直播模式"})]})}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,a.jsx)(f,{leaderboard:m.slice(0,5)}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"比赛状态"}),i?(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:["状态: ",(0,a.jsx)("span",{className:"font-medium",children:i.status})]}),(0,a.jsxs)("div",{children:["轮次: ",(0,a.jsxs)("span",{className:"font-medium",children:[i.current_round,"/",i.total_rounds]})]}),i.time_remaining&&(0,a.jsxs)("div",{children:["剩余时间: ",(0,a.jsx)("span",{className:"font-medium",children:w(i.time_remaining)})]})]}):(0,a.jsx)("p",{className:"text-gray-500",children:"暂无状态信息"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(C.z,{comments:h,isConnected:s,className:"min-h-[400px]"}),(0,a.jsx)(E,{streamMode:u,onModeChange:j,bilibiliUrl:null==t?void 0:t.bilibili_url})]})]})})]})}},1860:function(e,s,t){"use strict";t.d(s,{z:function(){return x}});var a=t(7437),c=t(2265),l=t(2369),n=t(2718),r=t(4743),i=t(988),o=t(2906),d=t(572);let m=e=>{let{comment:s}=e;return(0,a.jsxs)("div",{className:"chat-message other",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)(l.Z,{className:"w-3 h-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700",children:s.username}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:(0,o.Z)(new Date(s.timestamp),{addSuffix:!0,locale:d.Z})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-800",children:s.content})]})},x=e=>{let{comments:s,isConnected:t,className:o=""}=e,[d,x]=(0,c.useState)(""),[h,u]=(0,c.useState)(""),j=(0,c.useRef)(null),[g,p]=(0,c.useState)(!1),b=()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};return(0,c.useEffect)(()=>{b()},[s]),(0,c.useEffect)(()=>{let e=localStorage.getItem("mc_live_username");e&&(u(e),p(!0))},[]),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg flex flex-col ".concat(o),children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,a.jsx)(n.Z,{className:"w-5 h-5 mr-2 text-green-500"}),"实时聊天",(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",s.length," 条消息)"]})]})}),(0,a.jsx)("div",{className:"flex-1 p-4 max-h-64 overflow-y-auto custom-scrollbar",children:0===s.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)(n.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),(0,a.jsx)("p",{className:"text-sm",children:"暂无聊天消息"}),(0,a.jsx)("p",{className:"text-xs",children:"成为第一个发言的人！"})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[s.map(e=>(0,a.jsx)(m,{comment:e},e.id)),(0,a.jsx)("div",{ref:j})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:g?(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.trim()&&t&&h&&(i.X.sendComment(h,d.trim()),x(""))},className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)(l.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:h}),(0,a.jsx)("button",{type:"button",onClick:()=>p(!1),className:"text-blue-500 hover:text-blue-600 ml-auto",children:"更换昵称"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:t?"输入消息...":"连接中...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:200,disabled:!t}),(0,a.jsx)("button",{type:"submit",disabled:!d.trim()||!t,className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center",children:(0,a.jsx)(r.Z,{className:"w-4 h-4"})})]}),!t&&(0,a.jsx)("p",{className:"text-xs text-red-500",children:"连接已断开，请等待重连..."})]}):(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),h.trim()&&(localStorage.setItem("mc_live_username",h.trim()),p(!0))},className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"设置昵称后开始聊天"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>u(e.target.value),placeholder:"输入你的昵称...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:20,required:!0})]}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors",children:"确认昵称"})]})})]})}},6689:function(e,s,t){"use strict";t.d(s,{I:function(){return a}});let a=(0,t(9625).Ue)((e,s)=>({isConnected:!1,currentMatchId:null,currentTournamentId:null,match:null,matchStatus:null,tournament:null,tournamentStages:[],currentStage:null,votingSessions:[],currentVotingSession:null,votingOptions:[],events:[],playerScores:[],leaderboard:[],teamStats:[],comments:[],streamMode:"text",setConnected:s=>e({isConnected:s}),setCurrentMatch:s=>e({currentMatchId:s}),setCurrentTournament:s=>e({currentTournamentId:s}),setMatch:s=>e({match:s}),setMatchStatus:s=>e({matchStatus:s}),setTournament:s=>e({tournament:s}),setTournamentStages:s=>e({tournamentStages:s}),setCurrentStage:s=>e({currentStage:s}),setVotingSessions:s=>e({votingSessions:s}),setCurrentVotingSession:s=>e({currentVotingSession:s}),setVotingOptions:s=>e({votingOptions:s}),addEvent:s=>e(e=>({events:[s,...e.events].slice(0,100)})),updatePlayerScores:s=>e({playerScores:s}),updateLeaderboard:s=>e({leaderboard:s}),updateTeamStats:s=>e({teamStats:s}),addComment:s=>e(e=>({comments:[s,...e.comments].slice(0,50)})),setStreamMode:s=>e({streamMode:s}),clearData:()=>e({events:[],playerScores:[],leaderboard:[],teamStats:[],comments:[],matchStatus:null,currentStage:null,votingSessions:[],currentVotingSession:null,votingOptions:[]})}))},988:function(e,s,t){"use strict";t.d(s,{X:function(){return l}});var a=t(6689);class c{connect(e){if(this.socket&&this.socket.connected){if(a.I.getState().currentMatchId===e)return;this.disconnect()}let s="https:"===window.location.protocol?"wss:":"ws:",t="".concat(s,"//").concat(window.location.host,"/ws/live/").concat(e);this.connectWebSocket(t,e)}connectWebSocket(e,s){try{let t=new WebSocket(e);t.onopen=()=>{console.log("✅ WebSocket连接成功: ".concat(s)),this.reconnectAttempts=0,a.I.getState().setConnected(!0),a.I.getState().setCurrentMatch(s)},t.onmessage=e=>{try{let s=JSON.parse(e.data);this.handleMessage(s)}catch(e){console.error("解析WebSocket消息失败:",e)}},t.onclose=()=>{console.log("\uD83D\uDD0C WebSocket连接已断开"),a.I.getState().setConnected(!1),this.attemptReconnect(e,s)},t.onerror=e=>{console.error("❌ WebSocket连接错误:",e),a.I.getState().setConnected(!1)},this.socket=t}catch(e){console.error("创建WebSocket连接失败:",e)}}handleMessage(e){let s=a.I.getState();switch(e.type){case"connection_established":console.log("\uD83C\uDFAE 已连接到直播间:",e.match_id);break;case"game_event":console.log("\uD83C\uDFAF 收到游戏事件:",e.event),s.addEvent(e.event);break;case"player_scores_update":console.log("\uD83D\uDCCA 玩家分数更新:",e.players),s.updatePlayerScores(e.players);break;case"leaderboard_update":console.log("\uD83C\uDFC6 排行榜更新:",e.leaderboard),s.updateLeaderboard(e.leaderboard);break;case"match_status_update":console.log("⚡ 比赛状态更新:",e.status),s.setMatchStatus(e.status);break;case"team_stats_update":console.log("\uD83D\uDC65 团队数据更新:",e.teams),s.updateTeamStats(e.teams);break;case"new_comment":console.log("\uD83D\uDCAC 新评论:",e.comment),s.addComment(e.comment);break;case"pong":break;default:console.log("\uD83D\uDCE9 未知消息类型:",e.type,e)}}sendMessage(e){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(e)):console.warn("WebSocket未连接，无法发送消息")}sendComment(e,s){this.sendMessage({type:"comment",username:e,content:s})}sendPing(){this.sendMessage({type:"ping",timestamp:new Date().toISOString()})}attemptReconnect(e,s){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("❌ 达到最大重连次数，停止重连");return}this.reconnectAttempts++;let t=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log("\uD83D\uDD04 ".concat(t,"ms后尝试第").concat(this.reconnectAttempts,"次重连...")),setTimeout(()=>{this.connectWebSocket(e,s)},t)}disconnect(){this.socket&&(this.socket.close(),this.socket=null),a.I.getState().setConnected(!1)}isConnected(){return!!this.socket&&this.socket.readyState===WebSocket.OPEN}constructor(){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3}}let l=new c}},function(e){e.O(0,[203,327,971,117,744],function(){return e(e.s=5790)}),_N_E=e.O()}]);